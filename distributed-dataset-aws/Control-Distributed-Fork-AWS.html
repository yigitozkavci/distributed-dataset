<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Control.Distributed.Fork.AWS</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">distributed-dataset-aws-0.0.1.0: AWS backends for distributed-dataset.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Control.Distributed.Fork.AWS</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Usage</a></li><li><a href="#g:2">Options</a></li></ul></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:withLambdaBackend">withLambdaBackend</a> :: <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> -&gt; (<a href="../distributed-dataset/Control-Distributed-Fork-Backend.html#t:Backend" title="Control.Distributed.Fork.Backend">Backend</a> -&gt; <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/System-IO.html#t:IO" title="System.IO">IO</a> a</li><li class="src short"><span class="keyword">data</span> <a href="#t:LambdaBackendOptions">LambdaBackendOptions</a></li><li class="src short"><a href="#v:lambdaBackendOptions">lambdaBackendOptions</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Data-Text.html#t:Text" title="Network.AWS.Data.Text">Text</a> -&gt; <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a></li><li class="src short"><a href="#v:lboPrefix">lboPrefix</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Data-Text.html#t:Text" title="Network.AWS.Data.Text">Text</a></li><li class="src short"><a href="#v:lboMemory">lboMemory</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:lboMaxConcurrentInvocations">lboMaxConcurrentInvocations</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:lboMaxConcurrentExecutions">lboMaxConcurrentExecutions</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:lboMaxConcurrentDownloads">lboMaxConcurrentDownloads</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:lboKeepStack">lboKeepStack</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Usage</h1></a><div class="top"><p class="src"><a id="v:withLambdaBackend" class="def">withLambdaBackend</a> :: <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> -&gt; (<a href="../distributed-dataset/Control-Distributed-Fork-Backend.html#t:Backend" title="Control.Distributed.Fork.Backend">Backend</a> -&gt; <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/System-IO.html#t:IO" title="System.IO">IO</a> a) -&gt; <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/System-IO.html#t:IO" title="System.IO">IO</a> a <a href="#v:withLambdaBackend" class="selflink">#</a></p><div class="doc"><p>Provides a <code><a href="../distributed-dataset/Control-Distributed-Fork-Backend.html#t:Backend" title="Control.Distributed.Fork.Backend">Backend</a></code> using AWS Lambda functions.</p><p>In order to do that, roughly:</p><ul><li>It creates a deployment archive containing the program binary and
     a tiny wrapper written in Python and uploads it to the given S3 bucket.</li><li>Creates a CloudFormation stack containing the Lambda function; and both
     an SQS queue and an S3 Bucket and to gather the answers.</li><li>It starts polling the SQS queue for any answers.</li><li>When executing, it invokes the Lambda function using asynchronous
     invocation mode. After the function finishes, it either puts the result
     directly into the SQS queue if the result is small enough (&lt; 200kb) or
     uploads it into the S3 bucket and sends a pointer to the file via the
     queue.</li><li>A separate thread on the driver continously polls the queue for answers
     and parses and returns it to the caller.</li><li>On exit, it deletes the CloudFormation stack.</li></ul><p>Some warts:</p><ul><li><p>The same binary should run on AWS Lambda. In practice, this means:</p><ul><li>You have to build and use this library on a Linux machine.</li><li>You have to statically link everything. You can use GHC's
'<code>-static -optl-static -optl-pthread -fPIC</code>' parameters for that.</li></ul></li><li>On AWS Lambda, more memory you assign to a function, more CPU you
     get. So it might make your function run faster if you overallocate
     memory.</li><li>When invoked asynchronously, AWS Lambda retries the invocation
     2 more times waiting a minute between every retry. This means when
     something fails, it will take at least a few minutes to until you
     get an exception.</li></ul><p>Example:</p><pre>{-# LANGUAGE StaticPointers #-}

import Control.Lens
import Control.Distributed.Fork
import Control.Distributed.Fork.Lambda

opts :: LambdaBackendOptions
opts = lambdaBackendOptions &quot;my-s3-bucket&quot;
         &amp; lboMemory .~ 1024

main :: IO ()
main = do
  <code>initDistributedFork</code>
  <code><a href="Control-Distributed-Fork-AWS.html#v:withLambdaBackend" title="Control.Distributed.Fork.AWS">withLambdaBackend</a></code> opts $ \backend -&gt; do
    handle &lt;- <code>fork</code> backend (static Dict) (static (return &quot;Hello from Lambda!&quot;))
    await handle &gt;&gt;= putStrLn
</pre></div></div><a href="#g:2" id="g:2"><h1>Options</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LambdaBackendOptions" class="def">LambdaBackendOptions</a> <a href="#t:LambdaBackendOptions" class="selflink">#</a></p><div class="doc"><p>Options required for creating a Lambda backend.</p><p>Use <code><a href="Control-Distributed-Fork-AWS.html#v:lambdaBackendOptions" title="Control.Distributed.Fork.AWS">lambdaBackendOptions</a></code> smart constructor to create and lenses below for
 setting optional fields.</p></div></div><div class="top"><p class="src"><a id="v:lambdaBackendOptions" class="def">lambdaBackendOptions</a> <a href="#v:lambdaBackendOptions" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Data-Text.html#t:Text" title="Network.AWS.Data.Text">Text</a></td><td class="doc"><p>Name of the S3 bucket to store the deployment archive in.</p></td></tr><tr><td class="src">-&gt; <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:lboPrefix" class="def">lboPrefix</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Data-Text.html#t:Text" title="Network.AWS.Data.Text">Text</a> <a href="#v:lboPrefix" class="selflink">#</a></p><div class="doc"><p>Prefix to the deployment archive and the CloudFormation stack.</p><p>Default: &quot;distributed-dataset&quot;</p></div></div><div class="top"><p class="src"><a id="v:lboMemory" class="def">lboMemory</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="#v:lboMemory" class="selflink">#</a></p><div class="doc"><p>Desired memory for the Lambda functions.</p><p>See <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html#cfn-lambda-function-memorysize">CloudFormation's AWS::Lambda::Function::MemorySize page</a> for allowed values.</p><p>Default: 1024</p></div></div><div class="top"><p class="src"><a id="v:lboMaxConcurrentInvocations" class="def">lboMaxConcurrentInvocations</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="#v:lboMaxConcurrentInvocations" class="selflink">#</a></p><div class="doc"><p>Maximum number of concurrent &quot;invoke&quot; calls to AWS API to trigger executions.</p><p>Non-positive values disable the throttling.</p><p>Default: 64</p></div></div><div class="top"><p class="src"><a id="v:lboMaxConcurrentExecutions" class="def">lboMaxConcurrentExecutions</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="#v:lboMaxConcurrentExecutions" class="selflink">#</a></p><div class="doc"><p>Maximum number of concurrently executing Lambda functions.</p><p>Non-positive values disable the throttling.</p><p>Default: 0</p></div></div><div class="top"><p class="src"><a id="v:lboMaxConcurrentDownloads" class="def">lboMaxConcurrentDownloads</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="#v:lboMaxConcurrentDownloads" class="selflink">#</a></p><div class="doc"><p>If the size of the return value from your function is larger than 200 kilobytes,
 we fetch the results via S3. This parameter sets the maximum number of concurrent
 downloads from S3.</p><p>Non-positive values disable the throttling.</p><p>Default: 16</p></div></div><div class="top"><p class="src"><a id="v:lboKeepStack" class="def">lboKeepStack</a> :: <a href="http://hackage.haskell.org/packages/archive/amazonka-core/1.6.1/doc/html/Network-AWS-Lens.html#t:Lens-39-" title="Network.AWS.Lens">Lens'</a> <a href="Control-Distributed-Fork-AWS.html#t:LambdaBackendOptions" title="Control.Distributed.Fork.AWS">LambdaBackendOptions</a> <a href="http://hackage.haskell.org/packages/archive/base/4.12.0.0/doc/html/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:lboKeepStack" class="selflink">#</a></p><div class="doc"><p>Whether to keep the CloudFormation stack after the <code><a href="Control-Distributed-Fork-AWS.html#v:withLambdaBackend" title="Control.Distributed.Fork.AWS">withLambdaBackend</a></code> call.
 Useful for debugging.</p><p>Default: Fales</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>